set.seed(42)
n_flips <- 10000
flips <- rbinom(n_flips, 1, 0.5)  # 1: 앞면
heads_ratio <- mean(flips)
cat("앞면 비율:", round(heads_ratio, 4), "\n")  # 0.501
cumulative <- cumsum(flips) / seq_len(n_flips)
plot(cumulative, type="l", xlab="던진 횟수", ylab="누적 앞면 비율",
main="법칙의 대수", ylim=c(0.4, 0.6))
abline(h=0.5, col="red", lty=2)
load("C:/Users/jyo52/OneDrive/Desktop/R/동전던지기/.RData")
png("my_plot.png", width=800, height=600)
plot(cumulative, type="l", xlab="던진 횟수", ylab="누적 앞면 비율", main="법칙의 대수", ylim=c(0.4, 0.6))
abline(h=0.5, col="red", lty=2)
dev.off()
png("my_plot.png", width=800, height=600)
plot(cumulative, type="l", xlab="던진 횟수", ylab="누적 앞면 비율", main="동전 던지기기", ylim=c(0.4, 0.6))
abline(h=0.5, col="red", lty=2)
dev.off()
png("my_plot.png", width=800, height=600)
plot(cumulative, type="l", xlab="던진 횟수", ylab="누적 앞면 비율", main="동전 던지기", ylim=c(0.4, 0.6))
abline(h=0.5, col="red", lty=2)
dev.off()
set.seed(42)
n_flips <- 10000
flips <- rbinom(n_flips, 1, 0.5)  # 1: 앞면
heads_ratio <- mean(flips)
cat("앞면 비율:", round(heads_ratio, 4), "\n")  # 0.501
cumulative <- cumsum(flips) / seq_len(n_flips)
plot(cumulative, type="l", xlab="던진 횟수", ylab="누적 앞면 비율",
main="법칙의 대수", ylim=c(0.4, 0.6))
abline(h=0.5, col="red", lty=2)
set.seed(42)
n_time <- 100
n_roi <- 5
time_series <- matrix(rnorm(n_time * n_roi), n_time, n_roi)
time_series[,2] <- 0.7 * time_series[,1] + rnorm(n_time, 0, 0.5)  # 연결성 추가하기기
corr_matrix <- cor(time_series)
diag(corr_matrix) <- 0  # 자기상관 제거하는 것것
# 시각화하는 방법!
image(1:n_roi, 1:n_roi, corr_matrix, zlim=c(-1,1), col=rev(heat.colors(101)),
xlab="ROI", ylab="ROI", main="RS-fMRI Correlation Matrix")
set.seed(42)
n_time <- 100
n_roi <- 5
time_series <- matrix(rnorm(n_time * n_roi), n_time, n_roi)
time_series[,2] <- 0.7 * time_series[,1] + rnorm(n_time, 0, 0.5)  # 연결성 추가하기기
corr_matrix <- cor(time_series)
diag(corr_matrix) <- 0  # 자기상관 제거하는 것것
# 시각화하는 방법!
image(1:n_roi, 1:n_roi, corr_matrix, zlim=c(-1,1), col=rev(heat.colors(101)),
xlab="ROI", ylab="ROI", main="RS-fMRI Correlation Matrix")
# 기존 correlation 행렬 (ROI 간 FC)
cor_matrix <- cor(rs_fmri_data)  # 예시임.
# 샘플 RS-fMRI ROI 시계열 데이터 생성 (10 ROI x 200 timepoints)
set.seed(123)
n_roi <- 10
n_time <- 200
rs_fmri_data <- matrix(rnorm(n_roi * n_time), n_roi, n_time)
# 1-4) Correlation 행렬 계산
cor_matrix <- cor(rs_fmri_data)
print("Correlation 행렬 상위 3x3:")
print(round(cor_matrix[1:3,1:3], 3))
# Fisher Z 변환
z_matrix <- atanh(cor_matrix)
# 1-5) Z 행렬 원소 확인 (대각 제외)
upper_z <- z_matrix[upper.tri(z_matrix)]
print("Z 변환 원소 통계:")
summary(upper_z)
# 역변환 확인
print("tanh(z) == 원래 r 확인 (상위 3x3):")
print(round(tanh(z_matrix)[1:3,1:3], 3))
# 1-6) 시각화
library(corrplot)
corrplot(cor_matrix, method="color", type="upper", order="hclust",
title="RS-fMRI Correlation Matrix", tl.cex=0.7)
corrplot(z_matrix, method="color", type="upper", order="hclust",
title="Fisher Z Transformed Matrix", tl.cex=0.7)
# 샘플 RS-fMRI ROI 시계열 데이터 생성 (10 ROI x 200 timepoints)
set.seed(123)
n_roi <- 10
n_time <- 200
rs_fmri_data <- matrix(rnorm(n_roi * n_time), n_roi, n_time)
# 1-4) Correlation 행렬 계산
cor_matrix <- cor(rs_fmri_data)
print("Correlation 행렬 상위 3x3:")
print(round(cor_matrix[1:3,1:3], 3))
# Fisher Z 변환
cor_matrix <- cor(rs_fmri_data)
z_matrix <- atanh(cor_matrix)
# 1-5) Z 행렬 원소 확인 (대각 제외)
upper_z <- z_matrix[upper.tri(z_matrix)]
print("Z 변환 원소 통계:")
summary(upper_z)
# 역변환 확인
print("tanh(z) == 원래 r 확인 (상위 3x3):")
print(round(tanh(z_matrix)[1:3,1:3], 3))
# 대각 Inf 처리
diag(z_matrix) <- NA
# 시각화
library(corrplot)
corrplot(cor_matrix, method="color", type="upper", order="hclust",
title="1. Correlation Matrix")
z_clipped <- pmin(pmax(z_matrix, -3), 3)
corrplot(z_clipped, method="color", type="upper", order="hclust",
title="1-6. Fisher Z Matrix", is.corr=FALSE, cl.lim=c(-3,3))
# 샘플 RS-fMRI ROI 시계열 데이터 생성 (10 ROI x 200 timepoints)
set.seed(123)
n_roi <- 10
n_time <- 200
rs_fmri_data <- matrix(rnorm(n_roi * n_time), n_roi, n_time)
# 1-4) Correlation 행렬 계산
cor_matrix <- cor(rs_fmri_data)
print("Correlation 행렬 상위 3x3:")
print(round(cor_matrix[1:3,1:3], 3))
# Fisher Z 변환
z_matrix <- atanh(cor_matrix)
# 1-5) Z 행렬 원소 확인 (대각 제외)
upper_z <- z_matrix[upper.tri(z_matrix)]
print("Z 변환 원소 통계:")
summary(upper_z)
# 역변환 확인
print("tanh(z) == 원래 r 확인 (상위 3x3):")
print(round(tanh(z_matrix)[1:3,1:3], 3))
# 대각선 처리: Z 행렬 시각화를 위해 NA로 설정 (corrplot이 자동 처리)
diag(z_matrix) <- NA
# 패키지 로드
library(corrplot)
# 상관행렬 시각화
corrplot(cor_matrix, method="color", type="upper", order="hclust",
title="1. Correlation Matrix")
# Fisher Z 행렬 시각화 (오류 수정: cl.lim → col.lim, is.corr=FALSE 유지)
z_clipped <- pmin(pmax(z_matrix, -3), 3)
corrplot(z_clipped, method="color", type="upper", order="hclust",
title="1-6. Fisher Z Matrix", is.corr=FALSE, col.lim=c(-3,3))
# 파일명: "rs_fmri_fisher_z_complete.R"
# 샘플 RS-fMRI ROI 시계열 데이터 생성 (10 ROI x 200 timepoints)
set.seed(123)
n_roi <- 10
n_time <- 200
rs_fmri_data <- matrix(rnorm(n_roi * n_time), n_roi, n_time)
# 1-4) 현재 RS-fMRI로 구한 correlation에 Fisher Z 변환 적용
cor_matrix <- cor(rs_fmri_data)
print("RS-fMRI Correlation 행렬 상위 3x3:")
print(round(cor_matrix[1:3,1:3], 3))
# Fisher Z 변환: r → z = atanh(r) 적용
z_matrix <- atanh(cor_matrix)
# 1-5) Z 행렬 원소 확인 (대각 제외)
upper_z <- z_matrix[upper.tri(z_matrix)]
print("Z 변환 원소 통계:")
summary(upper_z)
print(paste("Z 원소 범위:", round(min(upper_z), 3), "~", round(max(upper_z), 3)))
# 역변환 확인
print("tanh(z) == 원래 r 확인 (상위 3x3):")
print(round(tanh(z_matrix)[1:3,1:3], 3))
# 대각선 처리: Z 행렬 시각화를 위해 NA로 설정 (corrplot이 자동 처리)
diag(z_matrix) <- NA
# 1-6) 변환 후 행렬 시각화
library(corrplot)
# 상관행렬 시각화
corrplot(cor_matrix, method="color", type="upper", order="hclust",
title="1-4. RS-fMRI Correlation Matrix", tl.cex=0.8)
# Fisher Z 행렬 시각화
z_clipped <- pmin(pmax(z_matrix, -3), 3)
corrplot(z_clipped, method="color", type="upper", order="hclust",
title="1-6. Fisher Z Matrix (-3 ~ 3)",
is.corr=FALSE, col.lim=c(-3,3), tl.cex=0.8)
# 파일명: "rs_fmri_fisher_z_complete.R"
# 샘플 RS-fMRI ROI 시계열 데이터 생성 (10 ROI x 200 timepoints)
set.seed(123)
n_roi <- 10
n_time <- 200
rs_fmri_data <- matrix(rnorm(n_roi * n_time), n_roi, n_time)
# 1-4) 현재 RS-fMRI로 구한 correlation에 Fisher Z 변환 적용
cor_matrix <- cor(rs_fmri_data)
print("RS-fMRI Correlation 행렬 상위 3x3:")
print(round(cor_matrix[1:3,1:3], 3))
# Fisher Z 변환: r → z = atanh(r) 적용
z_matrix <- atanh(cor_matrix)
# 1-5) Z 행렬 원소 확인
upper_z <- z_matrix[upper.tri(z_matrix)]
print("Z 변환 원소 통계:")
summary(upper_z)
print(paste("Z 원소 범위:", round(min(upper_z), 3), "~", round(max(upper_z), 3)))
# 1-5) 원소 print =====
print("1-5-2) Z 행렬 원소 테이블 형식 (ROI-A, B, r, z, p, significance):")
df_results <- data.frame(
ROI_A = character(),
ROI_B = character(),
raw_correlation = numeric(),
fisher_z = numeric(),
p_value = numeric(),
significance = character(),
stringsAsFactors = FALSE
)
for(i in 1:(n_roi-1)) {
for(j in (i+1):n_roi) {
ct <- cor.test(rs_fmri_data[i,], rs_fmri_data[j,])
z_val <- atanh(ct$estimate)
sig <- ifelse(ct$p.value < 0.001, "***",
ifelse(ct$p.value < 0.01, "**",
ifelse(ct$p.value < 0.05, "*", "not significant")))
df_results <- rbind(df_results, data.frame(
ROI_A = paste0("ROI", i),
ROI_B = paste0("ROI", j),
raw_correlation = round(ct$estimate, 3),
fisher_z = round(z_val, 3),
p_value = format(ct$p.value, scientific=TRUE, digits=3),
significance = sig
))
}
}
print(df_results[1:min(10, nrow(df_results)), ])
print(paste("총", nrow(df_results), "개 ROI 쌍"))
# 역변환 확인
print("tanh(z) == 원래 r 확인 (상위 3x3):")
print(round(tanh(z_matrix)[1:3,1:3], 3))
# 대각선 처리: Z 행렬 시각화를 위해 NA로 설정 (corrplot이 자동 처리)
diag(z_matrix) <- NA
# 1-6) 변환 후 행렬 시각화
library(corrplot)
# 행렬 시각화
library(corrplot)
corrplot(cor_matrix, method="color", type="upper", order="hclust",
title="1-4. RS-fMRI Correlation Matrix", tl.cex=0.8, mar=c(0,0,2,0))
z_clipped <- pmin(pmax(z_matrix, -3), 3)
corrplot(z_clipped, method="color", type="upper", order="hclust",
title="1-6. Fisher Z Matrix (-3 ~ 3)",
is.corr=FALSE, col.lim=c(-3,3), tl.cex=0.8, mar=c(0,0,2,0))
set.seed(42)
n_time <- 100
n_roi <- 5
time_series <- matrix(rnorm(n_time * n_roi), n_time, n_roi)
time_series[,2] <- 0.7 * time_series[,1] + rnorm(n_time, 0, 0.5)  # 연결성 추가하기기
corr_matrix <- cor(time_series)
diag(corr_matrix) <- 0  # 자기상관 제거하는 것것
# 시각화하는 방법!
image(1:n_roi, 1:n_roi, corr_matrix, zlim=c(-1,1), col=rev(heat.colors(101)),
xlab="ROI", ylab="ROI", main="RS-fMRI Correlation Matrix")
set.seed(123)
n_roi <- 10
n_time <- 200
rs_fmri_data <- matrix(rnorm(n_roi * n_time), n_roi, n_time)
# 과제6) ============================================
df_results <- data.frame(
ROI_A = character(),
ROI_B = character(),
`raw correlation` = numeric(),
`Fisher Z` = numeric(),
`p_value` = character(),
significance = character(),
stringsAsFactors = FALSE
)
for(i in 1:(n_roi-1)) {
for(j in (i+1):n_roi) {
ct <- cor.test(rs_fmri_data[i,], rs_fmri_data[j,])
df_results <- rbind(df_results, data.frame(
ROI_A = paste0("ROI", i),
ROI_B = paste0("ROI", j),
`raw correlation` = round(ct$estimate, 3),
`Fisher Z` = round(atanh(ct$estimate), 3),
`p_value` = format(ct$p.value, scientific=TRUE, digits=3),
significance = ifelse(ct$p.value < 0.001, "***",
ifelse(ct$p.value < 0.01, "**",
ifelse(ct$p.value < 0.05, "*", "not significant")))
))
}
}
print("과제 6) Correlation 분석 결과 테이블 (45 ROI 쌍):")
print(df_results)
